<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Owner Panel - Matches</title>
<script src="https://api.backendless.com/sdk/js/latest/backendless.min.js"></script>
<style>
  :root{--accent:#1d74ff;--bg:#f6f8fb}
  body{font-family:Inter,Arial,Helvetica,sans-serif;background:var(--bg);margin:0;padding:18px}
  .card{background:#fff;border-radius:12px;padding:14px;margin-bottom:14px;box-shadow:0 6px 18px rgba(15,30,45,0.06)}
  h1{font-size:20px;margin:0 0 12px;color:#0b2a45}
  label{display:block;font-size:13px;color:#334; margin-top:8px}
  input,select,textarea,button{width:100%;padding:10px;border-radius:8px;border:1px solid #e2e8f0;box-sizing:border-box;font-size:15px}
  input:focus,textarea:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(29,116,255,0.08)}
  .row{display:flex;gap:10px}
  .row .col{flex:1}
  .small{font-size:13px;color:#667}
  .btn{background:var(--accent);color:#fff;border:none;cursor:pointer}
  .btn.danger{background:#ef4444}
  .topbar{display:flex;gap:10px;align-items:center;margin-bottom:12px}
  .logout{margin-left:auto;background:#ddd;color:#111;border:none;padding:8px 10px;border-radius:8px}
  .hidden{display:none}
  .match-list{display:grid;gap:12px}
  .match-item{display:flex;gap:12px;align-items:flex-start}
  .match-thumb{width:110px;height:70px;background:#eef;border-radius:8px;object-fit:cover}
  .match-meta{flex:1}
  .meta-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
  .chip{background:#eef;padding:6px 8px;border-radius:8px;font-size:13px;color:#334}
  footer{font-size:12px;color:#889;margin-top:18px;text-align:center}
  @media(min-width:720px){ .container{max-width:720px;margin:0 auto} .match-thumb{width:140px;height:90px} }
</style>
</head>
<body>
<div class="container">

  <div id="loginCard" class="card">
    <h1>Owner Login</h1>
    <p class="small">Enter owner password to open the panel.</p>
    <label>Owner Password</label>
    <input id="ownerPass" type="password" placeholder="Enter password">
    <div style="height:10px"></div>
    <button id="loginBtn" class="btn">Login</button>
    <p class="small" style="margin-top:10px">This panel runs in your browser. For stronger security use server-side auth.</p>
  </div>

  <div id="panel" class="hidden">
    <div class="topbar">
      <h1>Owner Panel</h1>
      <button id="logoutBtn" class="logout">Logout</button>
    </div>

    <div class="card">
      <h2 style="margin:0 0 8px">Add Match</h2>

      <label>ID</label>
      <input id="fldID" placeholder="Unique ID (or leave blank for auto)">

      <label>Match Name</label>
      <input id="fldName" placeholder="Match Name">

      <div class="row">
        <div class="col">
          <label>Participants</label>
          <input id="fldParticipants" type="number" placeholder="e.g. 100">
        </div>
        <div class="col">
          <label>Match Type</label>
          <input id="fldType" placeholder="Solo / Duo / Squad">
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label>Mode</label>
          <input id="fldMode" placeholder="Classic / Arcade">
        </div>
        <div class="col">
          <label>Date & Time</label>
          <input id="fldDateTime" type="datetime-local">
        </div>
      </div>

      <label>Image URL</label>
      <input id="fldImageURL" placeholder="https://...jpg">

      <div class="row">
        <div class="col">
          <label>Prize Pool</label>
          <input id="fldPrize" placeholder="e.g. ₹5000">
        </div>
        <div class="col">
          <label>Map</label>
          <input id="fldMap" placeholder="Bermuda / Erangel">
        </div>
      </div>

      <div style="height:12px"></div>
      <button id="addBtn" class="btn">Add Match</button>
    </div>

    <div class="card">
      <h2 style="margin:0 0 8px">Current Matches</h2>
      <div id="matchesContainer" class="match-list small">Loading...</div>
    </div>
  </div>

  <footer>Owner Panel • add / delete matches • Backendless</footer>
</div>

<script>
/* ====== CONFIG - DO NOT CHANGE BELOW UNLESS YOU KNOW WHAT YOU'RE DOING ====== */
const APP_ID = "08943DAB-53CC-453A-9E41-957BDCF9E5AC";    // your Backendless App ID
const JS_API_KEY = "8103DBA5-534D-493C-942D-21E5249F791C"; // your Backendless JS Key
const OWNER_PASSWORD = "GARENAISBEST";                    // owner password you asked
/* ========================================================================== */

Backendless.initApp(APP_ID, JS_API_KEY);

const loginCard = document.getElementById('loginCard');
const panel = document.getElementById('panel');
const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const ownerPass = document.getElementById('ownerPass');

const addBtn = document.getElementById('addBtn');
const matchesContainer = document.getElementById('matchesContainer');

function showPanel() {
  loginCard.classList.add('hidden');
  panel.classList.remove('hidden');
  loadMatches();
}
function showLogin() {
  loginCard.classList.remove('hidden');
  panel.classList.add('hidden');
  ownerPass.value = '';
}

// Simple client-side password check
loginBtn.addEventListener('click', () => {
  if (ownerPass.value === OWNER_PASSWORD) {
    showPanel();
  } else {
    alert('Incorrect password');
  }
});
logoutBtn.addEventListener('click', showLogin);

// Add Match
addBtn.addEventListener('click', async () => {
  const ID = document.getElementById('fldID').value.trim() || Date.now().toString();
  const MatchName = document.getElementById('fldName').value.trim();
  const Participants = document.getElementById('fldParticipants').value.trim();
  const MatchType = document.getElementById('fldType').value.trim();
  const Mode = document.getElementById('fldMode').value.trim();
  const DateTime = document.getElementById('fldDateTime').value.trim();
  const ImageURL = document.getElementById('fldImageURL').value.trim();
  const PrizePool = document.getElementById('fldPrize').value.trim();
  const Map = document.getElementById('fldMap').value.trim();

  if (!MatchName) { alert('Add Match Name'); return; }

  const item = {
    ID, MatchName, Participants, MatchType, Mode, DateTime, ImageURL, PrizePool, Map
  };

  try {
    await Backendless.Data.of("Matches").save(item);
    alert('Match added ✅');
    // clear fields
    document.getElementById('fldID').value = '';
    document.getElementById('fldName').value = '';
    document.getElementById('fldParticipants').value = '';
    document.getElementById('fldType').value = '';
    document.getElementById('fldMode').value = '';
    document.getElementById('fldDateTime').value = '';
    document.getElementById('fldImageURL').value = '';
    document.getElementById('fldPrize').value = '';
    document.getElementById('fldMap').value = '';
    loadMatches();
  } catch (e) {
    console.error(e);
    alert('Failed to add match. Check console.');
  }
});

// Load and display matches
async function loadMatches() {
  matchesContainer.innerHTML = 'Loading...';
  try {
    const matches = await Backendless.Data.of("Matches").find();
    if (!matches || matches.length === 0) {
      matchesContainer.innerHTML = '<div class="small">No matches yet</div>';
      return;
    }
    // build UI
    matchesContainer.innerHTML = '';
    matches.slice().reverse().forEach(m => {
      const div = document.createElement('div');
      div.className = 'card match-item';
      div.innerHTML = `
        <img class="match-thumb" src="${(m.ImageURL||'').replace(/"/g,'')}" onerror="this.style.display='none'"/>
        <div class="match-meta">
          <div style="font-weight:700">${escapeHtml(m.MatchName||m.title||'Untitled')}</div>
          <div class="small">${escapeHtml(m.DateTime || '')}</div>
          <div class="meta-row">
            <div class="chip">Prize: ${escapeHtml(m.PrizePool||'N/A')}</div>
            <div class="chip">Mode: ${escapeHtml(m.Mode||'')}</div>
            <div class="chip">Type: ${escapeHtml(m.MatchType||'')}</div>
            <div class="chip">Spots: ${escapeHtml(m.Participants||'')}</div>
            <div class="chip">Map: ${escapeHtml(m.Map||'')}</div>
          </div>
          <div style="margin-top:8px">
            <button class="btn" onclick="editMatch('${m.objectId}')">Edit</button>
            <button class="btn danger" onclick="deleteMatch('${m.objectId}')">Delete</button>
          </div>
        </div>
      `;
      matchesContainer.appendChild(div);
    });
  } catch (err) {
    console.error(err);
    matchesContainer.innerHTML = '<div class="small">Error loading matches</div>';
  }
}

// Edit (loads data into form)
window.editMatch = async function(objectId){
  try {
    const m = await Backendless.Data.of("Matches").findById(objectId);
    document.getElementById('fldID').value = m.ID || '';
    document.getElementById('fldName').value = m.MatchName || m.title || '';
    document.getElementById('fldParticipants').value = m.Participants || '';
    document.getElementById('fldType').value = m.MatchType || '';
    document.getElementById('fldMode').value = m.Mode || '';
    // If DateTime stored as ISO or string, keep it
    document.getElementById('fldDateTime').value = m.DateTime || '';
    document.getElementById('fldImageURL').value = m.ImageURL || '';
    document.getElementById('fldPrize').value = m.PrizePool || '';
    document.getElementById('fldMap').value = m.Map || '';
    window.scrollTo({top:0,behavior:'smooth'});
  } catch(e) {
    console.error(e);
    alert('Failed to load match for edit');
  }
};

// Delete match
window.deleteMatch = async function(objectId){
  if (!confirm('Delete this match?')) return;
  try {
    await Backendless.Data.of("Matches").remove({"objectId": objectId});
    alert('Deleted ✅');
    loadMatches();
  } catch (e) {
    console.error(e);
    alert('Failed to delete. Permission or network issue.');
  }
};

function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

// show login by default
showLogin();
</script>
</body>
  </html>
